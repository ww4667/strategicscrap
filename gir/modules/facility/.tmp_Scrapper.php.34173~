<?php 
/**
 * 
 * @author undead
 *
 */
class Scrapper extends Crud {
	
	private $objectNameId = null;
	
	protected $scrapperProperties = Array(	array("type"=>"text","label"=>"Company","field"=>"company"),
											array("type"=>"text","label"=>"Last Name","field"=>"last_name"),
											array("type"=>"text","label"=>"First Name","field"=>"first_name"),
											array("type"=>"text","label"=>"E-mail","field"=>"email"),
											array("type"=>"text","label"=>"Job Title","field"=>"job_title"),
											array("type"=>"text","label"=>"Business Phone","field"=>"business_phone"),
											array("type"=>"text","label"=>"Home Phone","field"=>"home_phone"),
											array("type"=>"text","label"=>"Mobile Phone","field"=>"mobile_phone"),
											array("type"=>"text","label"=>"Fax Number","field"=>"fax_number"),
											array("type"=>"text","label"=>"Address 1","field"=>"address_1"),
											array("type"=>"text","label"=>"Address 2","field"=>"address_2"),
											array("type"=>"text","label"=>"City","field"=>"city"),
											array("type"=>"text","label"=>"State/Province","field"=>"state_province"),
											array("type"=>"text","label"=>"Zip/Postal Code","field"=>"zip_postal_code"),
											array("type"=>"text","label"=>"Region","field"=>"region"),
											array("type"=>"text","label"=>"Country","field"=>"country"),
											array("type"=>"text","label"=>"Website","field"=>"website"),
											array("type"=>"text","label"=>"Notes","field"=>"notes"),
											array("type"=>"text","label"=>"Attachments","field"=>"attachments"),
											array("type"=>"text","label"=>"Category","field"=>"category"),
											array("type"=>"text","label"=>"Broker Exclusive","field"=>"broker_exclusive"),
											array("type"=>"date","label"=>"Created Timestamp","field"=>"created_timestamp"),
											array("type"=>"date","label"=>"Updated Timestamp","field"=>"updated_timestamp"));
	
	function __construct(){
		parent::__construct();
		parent::CreateDbConnection( $_SESSION['_DATABASE_CONNECTION'] );
		
		$createObject = parent::CreateObjectDefinition("scrapper",	$this->scrapperProperties);
		$this->objectNameId = $createObject[0]["id"];
		$this->properties = parent::ReadAllRelationshipsByObjectID($this->objectNameId);
		foreach ($this->properties as $p) {
			foreach ($this->scrapperProperties as $key => $val) {
				if ($val["field"] == $p["label"]) {
					$this->scrapperProperties[$key]["property_name_id"] = $p["property_name_id"];
				}
			}
		}
	}
	
	/**
	 * 
	 * @param $scrapperObject
	 */
	public function createNewScrapper( $scrapperObject ){
		/**
		 * expecting an array like so:
		 * 	Array(	"company"=>"SlashWeb",
					"last_name"=>"crown",
					"first_name"=>"greg");
		 */

		$i = 0; $propertyId = null;
		$objectId = parent::CreateObject($this->objectNameId);
		while( $i<count($this->scrapperProperties) ){
			if($scrapperObject[$this->scrapperProperties[$i]["field"]]){
				switch($this->scrapperProperties[$i]["type"]){
					case "text":
						parent::AddValueText($objectId, $this->scrapperProperties[$i]["property_name_id"], $scrapperObject[$this->scrapperProperties[$i]["field"]]);
						break;
					case "number":
						parent::AddValueNumber($objectId, $this->scrapperProperties[$i]["property_name_id"], $scrapperObject[$this->scrapperProperties[$i]["field"]]);
						break;
					case "date":
						parent::AddValueDate($objectId, $this->scrapperProperties[$i]["property_name_id"], $scrapperObject[$this->scrapperProperties[$i]["field"]]);
						break;
				}
			}
			
			$i++;
		}
	}
	
	public function getScrapperProperties(){
		return $this->scrapperProperties;
	}
	
	public function getAllScrappers(){
		$allScrappers = parent::ReadObjectsByObjectNameId( $this->objectNameId );
		$i = 0;
		$op = array();
		while( $i<count($allScrappers)){
			array_push($op,parent::ReadValuesByObjectId( $allScrappers[$i]["id"] ));
			$i++;
		}  
		return $op;
	}
	
}

/*
 		
		.1 ï¿½ Bundles
		.1 baling clips
		. 1 Bundles
		.1 Cast Iron
		.1 HMS
		.1Bushling
		.2 Bundles
		.2 HMS
		P&S
		.1 and .2 HMS
		Banding, Wire, Strapping Coils
		Black Sheet Clips
		Blast Furnace Iron
		Briquetted Steel
		Briquettes Iron
		Cast Iron Borings
		Cast Iron
		Catalytic Converters
		Cupola Cast
		EAF Chill Scrap
		Electric Furnace Steel
		Flame Cut
		Flashings
		Foundry Steel
		Iron Ore
		Machine Cast Iron
		Machine Shop Turnings
		Mill Scale
		Mixed Busheling
		MIxed Sheet Clips
		Motor Blocks
		OTM
		Pig Iron
		Pit Skulls
		Processed Cars
		Punchings & Plate
		Railroad Heavy Melt
		MST Shavings
		Sheet Slabs
		Shoveling Turnings
		Shredded Scrap
		Shredder Residue
		Steel Pit Scrap
		Cars/Autos
 */

?>