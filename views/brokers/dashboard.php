<div class="brokerDashboard">
<div class="leftCol">
<div class="lowerArea">
	<div class="twoColMod" id="recentResponses"><div class="moduleTop"><!-- IE hates empty elements --></div>
		<div class="moduleContent">
	    	<h3>QUOTE MANAGER</h3>
			<div class="more"><a href="[~27~]">advanced</a></div>
			<hr />
			<div class="filter">
				<div><input type="checkbox" name="filter_accepted" checked="checked" value="accepted" /> accepted</div>
				<div><input type="checkbox" name="filter_expired" checked="checked" value="expired" /> expired</div>
				<div><input type="checkbox" name="filter_rejected" checked="checked" value="rejected" /> rejected</div>
				<div><input type="checkbox" name="filter_waiting" checked="checked" value="waiting" /> waiting</div>
				<div style="clear:both;float:none"><!-- IE hates empty elemenets --></div>
			</div>
			<table>
			<tbody><tr class="row2">
			    <th style="width:100px">STATUS</th>
			    <th style="width:220px">DESCRIPTION</th>
			    <th style="width:100px">QUOTE DATE</th>
			    <th>&nbsp;</th>
			</tr>
			</tbody>
			</table>
			<div id="scroll-pane1" class="jScrollPaneContainer" tabindex="0">
			<table class="quotes stripes">
			<tbody>
			<tr class="accepted">
			    <td class="status" style="width:100px"><strong>Accepted</strong></td>
			    <td style="width:220px"><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/13/2010</td>
			    <td style="width:100px">04/30/2010</td>
			    <td><a class="archive" href="" title="archive this quote">archive</a></td>
			</tr>
			<tr class="row2 waiting">
			    <td class="status"><strong>Waiting</strong></td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br /><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/10/2010</td>
			    <td>05/03/2010</td>
			    <td><a class="archive" href="#" title="archive this quote">archive</a></td>
			</tr>
			<tr class="expired">
			    <td class="status"><strong>Expired</strong></td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/10/2010</td>
			    <td>05/04/2010</td>
			    <td><a class="archive" href="#" title="archive this quote">archive</a></td>
			</tr>
			<tr class="row2 rejected">
			    <td class="status"><strong>Rejected</strong></td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/10/2010</td>
			    <td>05/03/2010</td>
			    <td><a class="archive" href="#" title="archive this quote">archive</a></td>
			</tr>
			<tr class="waiting">
			    <td class="status"><strong>Waiting</strong></td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/10/2010</td>
			    <td>05/04/2010</td>
			    <td><a class="archive" href="#" title="archive this quote">archive</a></td>
			</tr>
			<tr class="row2 expired">
			    <td class="status"><strong>Expired</strong></td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/10/2010</td>
			    <td>05/03/2010</td>
			    <td><a class="archive" href="#" title="archive this quote">archive</a></td>
			</tr>
			<tr class="rejected">
			    <td class="status"><strong>Rejected</strong></td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Delivery Date:</strong> 05/10/2010</td>
			    <td>05/04/2010</td>
			    <td><a class="archive" href="#" title="archive this quote">archive</a></td>
			</tr>
		</tbody></table>
		</div>
		</div><div class="moduleBottom"><!-- IE hates empty elements --></div>	
	</div>
	<div class="twoColMod" id="recentRequests"><div class="moduleTop"><!-- IE hates empty elements --></div>
		<div class="moduleContent">
	    	<h3>Recent Requests</h3>
			<div class="more"><a href="[~22~]">advanced</a></div>
			<hr />
			<table>
			<tbody>
			<tr class="row2"	>
			    <th style="width:100px">EXPIRATION DATE</th>
			    <th style="width:220px">DESCRIPTION</th>
			    <th style="width:100px">REQUEST DATE</th>
			    <th>&nbsp;</th>
			</tr>
			</tbody>
			</table>
			<div id="scroll-pane2" class="jScrollPaneContainer" tabindex="0">
			<table class="stripes">
			<tbody id="recent_requests">
			<!-- 
			<tr>
			    <td style="width:100px">05/15/2010</td>
			    <td style="width:220px"><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Transportation Type:</strong> Flat Bed</td>
			    <td style="width:100px">04/30/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			<tr class="row2">
			    <td>2801-1207</td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Transportation Type:</strong> End Dumps</td>
			    <td>05/03/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			<tr>
			    <td>05/20/2010</td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong><strong>Transportation Type:</strong> Flat Bed</td>
			    <td>05/04/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			<tr class="row2">
			    <td>05/20/2010</td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Transportation Type:</strong> Flat Bed</td>
			    <td>05/03/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			<tr>
			    <td>05/23/2010</td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Transportation Type:</strong> End Dumps</td>
			    <td>05/04/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			<tr class="row2">
			    <td>05/12/2010</td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Transportation Type:</strong> Flat Bed</td>
			    <td>05/03/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			<tr>
			    <td>06/02/2010</td>
			    <td><strong>Ship from:</strong> Demo Scrap<br /><strong>Ship to:</strong> Demo Steel Company<br><strong>Material:</strong> No. 1 Machinery Cast<br><strong>Quantity (tons):</strong> 550<br><strong>Transportation Type:</strong> End Dumps</td>
			    <td>05/04/2010</td>
			    <td><a class="scrapQuote quote" href="#" title="quote this request">quote</a></td>
			</tr>
			-->
		</tbody></table>

		<script type="text/javascript"><!--
			var requestInterval = 0, reqObject = {}, current_request = -1, iii = 0;
			function getRequests(){
				$.getJSON("/controllers/remote_controller.php?method=getRequests", function(json) { 
//					clearTimeout( requestInterval );
					var tableRows = $("#recent_requests"), html = '', off=false, item=null, i = 0, l = json.length;
					
					if ( l > 0 ) { 
						for ( i; i < l; i++ ) {
							item = json[i];
							reqObject[item.id] = item; 
							html += '<tr class="'+ ( off ? 'row2' : '' ) + ' scrapQuote" requestId="' + item.id + '">' + 
									'	<td>' + item.expiration_date + '</td>' +
									'	<td>';
							if( 	item['join_facility'] && 
									item['join_facility'] != null && 
									item['join_facility'].length > 0 ){ 
										html += '		<strong>Ship to:</strong> ' + item['join_facility'][0]['company'] + '<br>'; }
									
							if( 	item['join_material'] && 
									item['join_material'] != null && 
									item['join_material'].length > 0 ){ 
										html += '		<strong>Material:</strong> ' + item['join_material'][0]['name'] + '<br>'; }
							html += '' +
									'		<strong>Quantity (tons):</strong> ' + item.volume + '<br>' +
									'		<strong>Delivery Date:</strong> ' + item.arrive_date + '' +'	</td>' +
									'	<td>' + item.created_ts + '</td>' + 
									'	<td>waiting</td>' + 
									'	<td><a class="quote" href="#" title="quote this request" requestId="' + item.id + '">quote</a></td>' + 
									'</tr>';
							off=!off;
						}

					    $("#recent_requests").html( html );
						$('#scroll-pane2').jScrollPane();
					    $(".scrapQuote").colorbox({	width:"550", inline:true, href:"#quoteForm", 
						    						onComplete:function(){ current_request = $( this ).attr( "requestId" ); console.log( 'current_request:' + current_request + ( iii++ )); loadBidForm();  } 
						    					});
					}
					
//					requestInterval = setTimeout("getRequests();",20000);
				});
			}

			function loadBidForm(  ){

				var item = reqObject[ current_request ]; 
				console.log( item );
				var scrapperData = "", facilityData = "";

				if( item['join_scrapper'] && item['join_scrapper'][0]['company'] ){ 
						scrapperData += item['join_scrapper'][0]['company'] + '<br />';
				} 
				
				if( item['join_scrapper'] && item['join_scrapper'][0]['address_1'] ){ 
						scrapperData += item['join_scrapper'][0]['address_1'] + '<br />';
				} 
				
				if( item['join_scrapper'] && item['join_scrapper'][0]['address_2'] ){ 
						scrapperData += item['join_scrapper'][0]['address_2'] + '<br />';
				} 
				
				if( item['join_scrapper'] && item['join_scrapper'][0]['city'] ){ 
						scrapperData += item['join_scrapper'][0]['city'] + ', ';
				} 
				
				if( item['join_scrapper'] && item['join_scrapper'][0]['state_province'] ){ 
						scrapperData += item['join_scrapper'][0]['state_province'] + ' ';
				} 
				
				if( item['join_scrapper'] && item['join_scrapper'][0]['zip_postal_code'] ){ 
						scrapperData += item['join_scrapper'][0]['zip_postal_code'] + ' ';
				} 

				if( scrapperData.length > 0 ){
					$("#bid_request_ship_from").html( scrapperData );
				} else {
					alert("This bid cannot happen because there is no Scrapper.");
				}


				if( item['join_request'] && item['join_request'][0] ){ 
					$("#join_request").val(item['join_request'][0]['id']);
				} 
				

				if( item['join_facility'] && item['join_facility'][0]['company'] ){ 
					facilityData += item['join_facility'][0]['company'] + '<br />';
				} 
				
				if( item['join_facility'] && item['join_facility'][0]['address_1'] ){ 
					facilityData += item['join_facility'][0]['address_1'] + '<br />';
				} 
				
				if( item['join_facility'] && item['join_facility'][0]['address_2'] ){ 
					facilityData += item['join_facility'][0]['address_2'] + '<br />';
				} 
				
				if( item['join_facility'] && item['join_facility'][0]['city'] ){ 
					facilityData += item['join_facility'][0]['city'] + ', ';
				} 
				
				if( item['join_facility'] && item['join_facility'][0]['state_province'] ){ 
					facilityData += item['join_facility'][0]['state_province'] + ' ';
				} 
				
				if( item['join_facility'] && item['join_facility'][0]['zip_postal_code'] ){ 
					facilityData += item['join_facility'][0]['zip_postal_code'] + ' ';
				} 

				if( facilityData.length > 0 ){
					$("#bid_request_ship_to").html( facilityData );
				} else {
					alert("This bid cannot happen because there is no Facility.");
				}

				if( item['join_material'] ){
					$("#bid_request_material").html( item['join_material'][0]['name'] );
					$("#join_transportation_type").val( item['join_material'][0]['id'] );
				} else {
					alert("This bid cannot happen because there is no Material.");
				}
				
				$("#bid_request_quantity").html( item['volume'] );
				$("#bid_request_delivery_date").html( item['arrive_date'] );
				$("#bid_request_preferred_transporation").html( item['transportation_type'] );
				
			}
			
			$(document).ready(function(){
				getRequests();
			});
		--></script>
		</div>
		</div><div class="moduleBottom"><!-- IE hates empty elements --></div>	
	</div>
</div>
</div>
<div class="rightCol">
	<div id="accountStatus" class="oneColMod"><div class="moduleTop"><!-- IE hates empty elements --></div>
		<div class="moduleContent">
			<h3>Account Info</h3>
			<div class="more"><a href="#">update</a></div>
			<hr />
			<div style="padding:10px">
				<p><strong>Quote Summary:</strong></p>
				<p>Accepted: 1<br />
				Rejected: 1<br />
				Waiting: 4<br />
				Expired: 2</p>
				<p>&nbsp;</p>
				<p><strong>Alert Status:</strong></p>
				<p>Hourly</p>
			</div>
		</div><div class="moduleBottom"><!-- IE hates empty elements --></div>
	</div>
	<div id="latestNews" class="oneColMod"><div class="moduleTop"><!-- IE hates empty elements --></div>
		<div class="moduleContent">
			<h3>Strategic News</h3>
			<hr />
			<p><strong>New Logistics Dashboard</strong><br />
			Strategic Scrap has improved your broker experience with the addition of the logistics dashboard.<br />
			<a href="#">More...</a></p>
		</div><div class="moduleBottom"><!-- IE hates empty elements --></div>
	</div>
	<div id="disclaimer" class="oneColMod"><div class="moduleTop"><!-- IE hates empty elements --></div>
		<div class="moduleContent">
			<h3>Disclaimer and Assumptions</h3>
			<hr />
			<p><strong>Delivery Date</strong><br />
			All loads must be delivered within 3 days of deliver date unless noted otherwise.</p>
			<p><strong>Pickup/Delivery Times</strong><br />
			Pickup times are to be between 7am-3pm facilty timezone. Delivery times are specific to receiving facility and should be coordinated by the transportaion broker.</p>
			<p><strong>Opperations</strong><br />
			Credit-checks are the responsibility of transporation brokers. Strategic Scrap is not responsible for breeched agreements.</p>
		</div><div class="moduleBottom"><!-- IE hates empty elements --></div>
	</div>
</div>
<div style="display:none">
	<div id="quoteForm" style="padding:20px; background:#fff;">
		<div id="bidForm">
			<h2>QUOTE THIS REQUEST</h2>
			<hr />
			<strong>Ship from:</strong> <span id="bid_request_ship_from">Demo Scrap, 123 N 1st, City, State Zip</span> <br />
			<strong>Ship to:</strong> <span id="bid_request_ship_to">Demo Scrap, 123 N 1st, City, State Zip</span><br />
			<strong>Material:</strong> <span id="bid_request_material">No. 1 Machinery Cast</span><br />
			<strong>Volume (tons):</strong> <span id="bid_request_quantity">550</span><br />
			<strong>Delivery Date:</strong> <span id="bid_request_delivery_date">05/13/2010</span><br />
			<strong>Preferred Transporation:</strong> <span id="bid_request_preferred_transporation">Flat Bed</span>
			<hr />
			<form id="quoteForm">
				<input name="join_broker" id="join_broker" type="hidden" value="<?=$_SESSION['user']['id']?>" />
				<input name="join_transportation_type" id="join_transportation_type" type="hidden" value="" />
				<input name="join_request" id="join_request" type="hidden" value="" />
				<ul class="form">
					<li>
						<label><strong>Transport Cost:</strong></label>
						<input name="transport_cost" id="transport_cost" type="text" />
					</li>
					<li>
						<label><strong>Price (per/GT):</strong></label>
						<input name="material_price" id="material_price" type="text" />
					</li>
					<li>
						<label><strong>Ship Date:</strong></label>
						<input name="ship_date" id="ship_date" type="text" />
					</li>
					<li>
						<label><strong>Arrival Date:</strong></label>
						<input name="arrival_date" id="arrival_date" type="text" />
					</li>
					<li>
						<label><strong>Additional Notes:</strong></label>
						<textarea name="notes" id="notes" style="width:273px; height:40px;"></textarea>
					</li>
				</ul>
				<div class="submitButton" style="text-align:left">
					<input id="submitQuote" value="Submit Quote" name="submitQuote" src="resources/images/buttons/submit_quote.png" type="button" />
				</div>
			</form>
		</div>
		<div id="bidResult" style></div>
	</div>
</div>
</div>
<script type="text/javascript">

	
//http://demo.strategicscrap.com/controllers/remote_controller.php?method=addBid&transport_cost=123.00&material_price=3.00&ship_date=2011-12-03%2003:22:12&arrival_date=2011-12-23%2007:22:12&notes=This%20is%20a%20note&join_request=146&join_transportation_type=154&join_broker=93
	$("#submitQuote").click(function() {
		if ( $("#transport_cost").val() != "" && 
			 $("#material_price").val() != "" && 
			 $("#ship_date").val() != "" && 
			 $("#arrival_date").val() != "" && 
			 $("#notes").val() != "" ) {

		     	console.log($("#quoteForm").serialize());
				$.post("/controllers/remote_controller.php?method=addBid", $("#quoteForm").serialize(),
				   function(data){
				     console.log("success");
				     console.log(data);
				   }, "json");
			   
				return false;
		}
		
		return false;
	});

    $(".scrapQuote").colorbox({width:"550", inline:true, href:"#quoteForm"});

</script>

